---
title: "[ë²ˆì—­] React íŒŒì´ë²„ íŠ¸ë¦¬ ìˆœíšŒëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜ìš”?"
datePublished: Wed May 08 2024 03:00:19 GMT+0000 (Coordinated Universal Time)
cuid: clvx8f0au00040amkg598674r
slug: react-internals-deep-dive-15
cover: https://cdn.hashnode.com/res/hashnode/image/upload/v1714984766193/dd1d92a0-3e22-409d-a6b3-c1fe5847c036.jpeg
tags: reactjs, react-internals, react-fiber-tree

---

> ***ì˜ë¬¸ ë¸”ë¡œê·¸ ê¸€ì„ ë²ˆì—­í–ˆìŠµë‹ˆë‹¤. í—ˆê°€ë¥¼ ë°›ìœ¼ë©´ ì‹œë¦¬ì¦ˆë¥¼ ì´ì–´ê°ˆ ì˜ˆì •ì…ë‹ˆë‹¤.  
> ì›ë¬¸ë§í¬:*** [https://jser.dev/react/2022/01/16/fiber-traversal-in-react](https://jser.dev/react/2022/01/16/fiber-traversal-in-react)

---

> ***â„¹ï¸***[***React Internals Deep Dive***](https://jser.dev/series/react-source-code-walkthrough.html) ***ì—í”¼ì†Œë“œ 15,*** [***ìœ íŠœë¸Œì—ì„œ ì œê°€ ì„¤ëª…í•˜ëŠ” ê²ƒ***](https://www.youtube.com/watch?v=3nwupG2Joaw&list=PLvx8w9g4qv_p-OS-XdbB3Ux_6DMXhAJC3&index=15)***ì„ ì‹œì²­í•´ì£¼ì„¸ìš”.***
> 
> ***âš ***[***React@18.2.0***](https://github.com/facebook/react/releases/tag/v18.2.0)***ê¸°ì¤€, ìµœì‹  ë²„ì „ì—ì„œëŠ” êµ¬í˜„ì´ ë³€ê²½ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.***
> 
> ***ğŸ’¬ ì—­ì ì£¼ì„: JSerì˜ ì½”ë©˜íŠ¸ëŠ” â—â—ë¡œ í‘œì‹œ í•´ë’€ìŠµë‹ˆë‹¤.  
> ê·¸ ì™¸ ì£¼ì„ì€ ë¦¬ì•¡íŠ¸ ì†ŒìŠ¤ ì½”ë“œ ìì²´ì˜ ì£¼ì„ì…ë‹ˆë‹¤.  
> ... ì€ ìƒëµëœ ì½”ë“œì…ë‹ˆë‹¤.***

## Fiber Tree êµ¬ì¡°

ì•ì„œ ì„¤ëª…í–ˆë“¯ì´, ReactëŠ” ë‚´ë¶€ì ìœ¼ë¡œ íŒŒì´ë²„ íŠ¸ë¦¬ë¥¼ ìœ ì§€í•˜ë©° ê³„ì† ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. ê° íŒŒì´ë²„ ë…¸ë“œì—ëŠ” êµ¬ì¡°ë¥¼ í˜•ì„±í•˜ëŠ” 3ê°€ì§€ í”„ë¡œí¼í‹°ê°€ ìˆìŠµë‹ˆë‹¤.

1. `child`, ì´ë¦„ì— ë”°ë¼ ê·¸ ìì‹ íŒŒì´ë²„.
    
2. `sibling`, ì´ë¦„ì— ë”°ë¼ ê·¸ í˜•ì œ íŒŒì´ë²„
    
3. `return`, (ì¼ì¢…ì˜)ë¶€ëª¨ íŒŒì´ë²„ë¼ê³  ìƒê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    

`children`ì´ ì—†ê¸° ë•Œë¬¸ì—, ì œê°€ ì¶”ì¸¡í•˜ê¸°ë¡œ React íŒ€ì€ íŠ¸ë¦¬ íƒìƒ‰ì„ ê°€ëŠ¥í•œ í•œ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•˜ê³  ì‹¶ê¸°ì—, ì´ ì„¸ ê°€ì§€ í”„ë¡œí¼í‹°ëŠ” ì¶©ë¶„íˆ ì˜ ì‘ë™í•  ê²ƒì…ë‹ˆë‹¤.

ì´ëŸ° ì¼ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[![](https://jser.dev/static/fiber-traversal.png align="left")](https://jser.dev/static/fiber-traversal.png)

## Fiber TreeëŠ” ì–´ë–»ê²Œ ìˆœíšŒí•˜ëŠ”ê°€

íŒŒì´ë²„ íŠ¸ë¦¬ë¥¼ ìˆœíšŒí•´ì•¼ í•˜ëŠ” ë§ì€ ì‹œë‚˜ë¦¬ì˜¤ê°€ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Reactê°€ íŒŒì´ë²„ íŠ¸ë¦¬ë¥¼ ìˆœíšŒí•˜ì—¬ íŒ¨ì‹œë¸Œ ì´í™íŠ¸(ì˜ˆ: `useEffect()`)ë¥¼ ë§ˆìš´íŠ¸í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤([ì†ŒìŠ¤](https://github.com/facebook/react/blob/e62a8d754548a490c2a3bcff3b420e5eedaf11c0/packages/react-reconciler/src/ReactFiberCommitWork.old.js#L2618)).

```typescript
export function commitPassiveMountEffects(
  root: FiberRoot,
  finishedWork: Fiber
): void {
  nextEffect = finishedWork;
  commitPassiveMountEffects_begin(finishedWork, root);
}
function commitPassiveMountEffects_begin(subtreeRoot: Fiber, root: FiberRoot) {
  while (nextEffect !== null) {
    const fiber = nextEffect;
    const firstChild = fiber.child;
    if ((fiber.subtreeFlags & PassiveMask) !== NoFlags && firstChild !== null) {
      ensureCorrectReturnPointer(firstChild, fiber);
      nextEffect = firstChild;
    } else {
      commitPassiveMountEffects_complete(subtreeRoot, root);
    }
  }
}
function commitPassiveMountEffects_complete(
  subtreeRoot: Fiber,
  root: FiberRoot
) {
  while (nextEffect !== null) {
    const fiber = nextEffect;
    if ((fiber.flags & Passive) !== NoFlags) {
      setCurrentDebugFiberInDEV(fiber);
      try {
        commitPassiveMountOnFiber(root, fiber);
      } catch (error) {
        reportUncaughtErrorInDEV(error);
        captureCommitPhaseError(fiber, fiber.return, error);
      }
      resetCurrentDebugFiberInDEV();
    }
    if (fiber === subtreeRoot) {
      nextEffect = null;
      return;
    }
    const sibling = fiber.sibling;
    if (sibling !== null) {
      ensureCorrectReturnPointer(sibling, fiber.return);
      nextEffect = sibling;
      return;
    }
    nextEffect = fiber.return;
  }
}
```

ReactëŠ” `begin()` ê³¼ `complete()`ë¡œ **ê° ë…¸ë“œë¥¼ ë‘ ë²ˆ ë°Ÿê¸°** ë•Œë¬¸ì—, ìº¡ì²˜ì™€ ë²„ë¸” ë‹¨ê³„ê°€ ìˆëŠ” DOM ì´ë²¤íŠ¸ë¼ê³  ìƒê°í•˜ë©´ ë˜ê³ , `begin()`ì€ `capture` ë‹¨ê³„, `complete(` )ëŠ” `bubble` ë‹¨ê³„ë¼ê³  ìƒê°í•˜ë©´ ë©ë‹ˆë‹¤.

ë¶€ëª¨ íŒŒì´ë²„ ë…¸ë“œê°€ ë¨¼ì € `begin()` ë˜ì§€ë§Œ ìì‹ë³´ë‹¤ ë‚˜ì¤‘ì— `complete()` ë©ë‹ˆë‹¤.

ì´ ì ‘ê·¼ ë°©ì‹ì€ `begin`ê³¼ `complete`ì˜ í¬ìŠ¤íŠ¸í”½ìŠ¤(ğŸ’¬ `_begin` ì´ëŸ° í˜•ì‹ì˜ ì ‘ë¯¸ì‚¬ ë„¤ì´ë°) ì™€ í•¨ê»˜ React ì†ŒìŠ¤ ì½”ë“œì˜ ëª¨ë“  ê³³ì— ìˆìœ¼ë¯€ë¡œ, ê¹Šì´ ë¹ ì§€ê¸° ì „ì— ì´ ì ‘ê·¼ ë°©ì‹ì— ìµìˆ™í•´ì ¸ì•¼ í•©ë‹ˆë‹¤.

## ì½”ë”© ì±Œë¦°ì§€

ì•Œê³ ë¦¬ì¦˜ì— ëŒ€í•œ ì´í•´ë¥¼ ë†’ì´ê¸° ìœ„í•´ ì½”ë”© ì±Œë¦°ì§€ë¥¼ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤. ì¦ê²¨ë³´ì„¸ìš”!

[JSerì˜ ë¸”ë¡œê·¸ ì½”ë”© ì±Œë¦°ì§€ ë§í¬](https://jser.dev/react/2022/01/16/fiber-traversal-in-react#coding-challenge)

[BFE.devì˜ ì½”ë”© ì±Œë¦°ì§€ ë§í¬](https://bigfrontend.dev/open_problem/t4yvsyilro3f4zo397)

(ì›ë³¸ ê²Œì‹œì¼: 2022-01-16)